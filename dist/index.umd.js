(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f["content-engine-lib"]={}))})(this,(function(f){"use strict";const u=()=>({set:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e=="x"?n:n&3|8).toString(16)})}),b=async()=>({f:{name:e=>`${e.name}${e.id}`}}),w=async()=>({set:async e=>{console.log("--theme");try{if(!e.el_id)throw new Error("[el_id] is required");const n=e.name,t=document.getElementById(e.el_id);if(!t)throw new Error("[el_id] is invalid");(r=>{const s=a=>{(_=>{const l=_.getAttribute("data-ce");if(!l)return;const i=JSON.parse(l).filter(y=>y?.k.startsWith("t-"));if(i.length!=0)for(const y of i){const o=y.k,k=y.v.split(" ");if(o==`t-${n}-class`)for(const h of k)_.classList.add(h);else for(const h of k)_.classList.remove(h)}})(a)};for(const a of r.getElementsByTagName("*"))s(a);s(r)})(t)}catch(n){const t=`err: [theme] ${n}`;throw console.log(t),t}}});function O(e,n=1e3){let t={cnt:0};return new Promise(r=>{const s=()=>{console.log(`[setInterval] is running.. [count=${t.cnt}]`);try{e()&&(clearInterval(a),r())}catch{console.log(`warn: [wait_until] ignoring the exception in setInterval and will check again after [interval=${n}]`)}t.cnt+=1},a=setInterval(()=>{s()},n);s()})}let E=class{listeners={};on=(n,t)=>((this.listeners[n]||=[]).push(t),()=>this.off(n,t));off=(n,t)=>{this.listeners[n]=this.listeners[n]?.filter(r=>r!==t)};emit=async(n,...t)=>{for(const r of this.listeners[n]??[])await r(...t)};emitParallel=async(n,...t)=>{await Promise.all((this.listeners[n]??[]).map(r=>r(...t)))};emitSafe=async(n,...t)=>{for(const r of this.listeners[n]??[])try{await r(...t)}catch(s){this.listeners.error?.forEach(a=>a(s))}}};const m=()=>new E;console.log("content-engine-lib");let c={lib:{inbuilt_lib:[],l:{},set:async e=>{const n=e?.lib||[];for(const[t,r]of n.entries()){const s=r,a=`${s.name}:${e.run_from}`,_=`${e.run_from}_src`;let l=s[_];const d=`${e.run_from}_src`;let i=e?.lazy_lib?.[d]||null;if(i&&(i=i.replace("{*}",`${s.name}`)),console.log(`_lazy_src: ${i}`),console.log(`_src: ${l}`),c.lib.l.hasOwnProperty(`${a}`)==!1){if(/^[a-zA-Z0-9]/.test(l)&&l.includes("/")==!1&&c.lib.inbuilt_lib.indexOf(`${s.name}`)===-1)if(i)l=i;else throw`[lib-name=${s.name},lib-src=${l}] not allowed or available in in-build mode. Need to use lazy-lib config.`;if(l.startsWith("./")||l.startsWith("../")){const y=await import(`${l}`);c.lib.l[`${a}`]={lib:y,src:l}}if(l.startsWith("http://")||l.startsWith("https://")){const y=await import(`${l}`);c.lib.l[`${a}`]={lib:y,src:l}}}}console.log(await c.lib.get_all({}))},get:async e=>{let n=null;const t=`${e.name}:${e.run_from}`;return c.lib.l.hasOwnProperty(`${t}`)==!1&&await c.lib.set({lib:[{renderer_src:e.name,hydrator_src:e.name,editor_src:e.name,name:e.name}],run_from:e.run_from,lazy_lib:e.lazy_lib}),n=c.lib.l[`${t}`],n},get_all:async e=>c.lib.l},path:{set:e=>{let n="",t="";const r=e.src.split("/");if(e.src.indexOf("://localhost")!==-1||e.src.indexOf("://127.0.0.1")!==-1||(t="/dist"),r.indexOf(e.type)!==-1)for(const[s,a]of r.entries()){let _=s==0?"":"/";if(n+=`${_}${a}`,a==e.type)return`${n}${t}${e.name}`}else for(const[s,a]of r.entries()){let _=s==0?"":"/";if(n+=`${_}${a}`,a=="src")return`${n}${t}${e.name}`}return`${n}${t}${e.name}`}}};const x=m(),g=m(),P=x.on,S=x.emit,T=g.emit,I=g.on,$=async e=>{const n=await b();return await c.lib.set({lib:e.lib,run_from:"renderer",lazy_lib:e.lazy_lib}),{set:async t=>{console.log("--renderer [set]");let r={r:"",style:"",head:""};return await(async()=>{for(const a of t.data?.value?.l||t.data.l){const _=await await c.lib.get({name:a.type,run_from:"renderer",lazy_lib:e.lazy_lib}),d=await(await _.lib.index({f:{name:i=>n.f.name({id:a.id,name:i}),get_lib:async i=>await await c.lib.get({name:i.name,run_from:i.run_from,lazy_lib:e.lazy_lib}),set_theme:async i=>await(await w()).set(i),path:i=>c.path.set({src:_.src,type:a.type,name:i})}})).set({data:{curr:a}});r.r+=d?.r||"",r.style+=d?.style||"",r.head+=d?.head||""}})(),r}}},p=async e=>{const n=await b();return await c.lib.set({lib:e.lib,run_from:"hydrator",lazy_lib:e.lazy_lib}),{set:async t=>{console.log("--hydrator [set]");let r={r:"",style:""};const s=async()=>{for(const a of t.data?.value?.l||t.data.l){const _=await await c.lib.get({name:a.type,run_from:"hydrator",lazy_lib:e.lazy_lib}),l=_.lib,d=m(),i=d.on,y=await(await l.index({my:{},f:{name:o=>n.f.name({id:a.id,name:o}),get_lib:async o=>await await c.lib.get({name:o.name,run_from:o.run_from,lazy_lib:e.lazy_lib}),set_theme:async o=>await(await w()).set(o),path:o=>c.path.set({src:_.src,type:a.type,name:o}),call:T,listen:i,new_emitter:()=>m()}})).set({data:{curr:a}});P("msg",async o=>{try{if(Object.keys(o.where||{}).length==0){await d.emit("msg",o);return}}catch{}try{if(a?.[o.where?.key||""]==o.where?.value){await d.emit("msg",o);return}}catch{}}),r.style+=y.style}};return await O(()=>document.readyState==="complete"||typeof window<"u",50),await s(),r}}},W=async e=>(await b(),await c.lib.set({lib:e.lib,run_from:"editor",lazy_lib:e.lazy_lib}),{set:async n=>{console.log("--editor [set]");let t={data:{l:[{id:u().set(),type:"editor",data:{l:[]}}]}},r={r:"",style:""};const s=$,a=p,_=await s({lib:e.lib,lazy_lib:e.lazy_lib}),l=await a({lib:e.lib,lazy_lib:e.lazy_lib}),d=await _.set({data:t.data});return(async()=>{const i=await l.set({data:t.data});(y=>{const o=document.createElement("style");o.innerHTML=`${i.style}`,y.appendChild(o)})(document.head)})(),r.r=d.r,r.style=`
            ${d.style}
            `,r}});f.ce_call=S,f.ce_editor=W,f.ce_hydrator=p,f.ce_listen=I,f.ce_renderer=$,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
