(function(_,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(_=typeof globalThis<"u"?globalThis:_||self,h(_["content-engine-lib"]={}))})(this,(function(_){"use strict";const h=()=>({set:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}),g=async()=>({f:{name:t=>`${t.name}${t.id}`}}),x=async()=>({set:async t=>{console.log("--theme");try{if(!t.el_id)throw new Error("[el_id] is required");const n=t.name,e=document.getElementById(t.el_id);if(!e)throw new Error("[el_id] is invalid");(s=>{const a=r=>{(d=>{const i=d.getAttribute("data-ce");if(!i)return;const u=JSON.parse(i).filter(l=>l?.k.startsWith("t-"));if(u.length!=0)for(const l of u){const f=l.k,b=l.v.split(" ");if(f==`t-${n}-class`)for(const o of b)d.classList.add(o);else for(const o of b)d.classList.remove(o)}})(r)};for(const r of s.getElementsByTagName("*"))a(r);a(s)})(e)}catch(n){const e=`err: [theme] ${n}`;throw console.log(e),e}}});function w(t,n=1e3){let e={cnt:0};return new Promise(s=>{const a=()=>{console.log(`[setInterval] is running.. [count=${e.cnt}]`);try{t()&&(clearInterval(r),s())}catch{console.log(`warn: [wait_until] ignoring the exception in setInterval and will check again after [interval=${n}]`)}e.cnt+=1},r=setInterval(()=>{a()},n);a()})}let T=class{listeners={};on=(n,e)=>((this.listeners[n]||=[]).push(e),()=>this.off(n,e));off=(n,e)=>{this.listeners[n]=this.listeners[n]?.filter(s=>s!==e)};emit=async(n,...e)=>{for(const s of this.listeners[n]??[])await s(...e)};emitParallel=async(n,...e)=>{await Promise.all((this.listeners[n]??[]).map(s=>s(...e)))};emitSafe=async(n,...e)=>{for(const s of this.listeners[n]??[])try{await s(...e)}catch(a){this.listeners.error?.forEach(r=>r(a))}}};const y=()=>new T;class ${startTime;endTime;isRunning;constructor(){this.startTime=0,this.endTime=0,this.isRunning=!1}start(){if(this.isRunning)throw new Error("Benchmark has already started.");this.startTime=performance.now(),this.isRunning=!0}stop(){if(!this.isRunning)throw new Error("Benchmark hasn't started.");this.endTime=performance.now(),this.isRunning=!1}result(){if(this.isRunning)throw new Error("Benchmark is still running.");return{time_taken_ms:(this.endTime-this.startTime).toFixed(4)}}}console.log("content-engine-lib");let c={lib:{inbuilt_lib:[],l:{},set:async t=>{const n=t?.lib||[];for(const[e,s]of n.entries()){const a=s,r=`${a.name}:${t.run_from}`,d=`${t.run_from}_src`;let i=a[d];const m=`${t.run_from}_src`;let u=t?.lazy_lib?.[m]||null;if(u&&(u=u.replace("{*}",`${a.name}`)),console.log(`_lazy_src: ${u}`),console.log(`_src: ${i}`),c.lib.l.hasOwnProperty(`${r}`)==!1){if(/^[a-zA-Z0-9]/.test(i)&&i.includes("/")==!1&&c.lib.inbuilt_lib.indexOf(`${a.name}`)===-1)if(u)i=u;else throw`[lib-name=${a.name},lib-src=${i}] not allowed or available in in-build mode. Need to use lazy-lib config.`;if(i.startsWith("./")||i.startsWith("../")){const l=await import(`${i}`);c.lib.l[`${r}`]={lib:l,src:i}}if(i.startsWith("http://")||i.startsWith("https://")){const l=await import(`${i}`);c.lib.l[`${r}`]={lib:l,src:i}}}}console.log(await c.lib.get_all({}))},get:async t=>{let n=null;const e=`${t.name}:${t.run_from}`;return c.lib.l.hasOwnProperty(`${e}`)==!1&&await c.lib.set({lib:[{renderer_src:t.name,hydrator_src:t.name,editor_src:t.name,name:t.name}],run_from:t.run_from,lazy_lib:t.lazy_lib}),n=c.lib.l[`${e}`],n},get_all:async t=>c.lib.l},path:{set:t=>{let n="",e="";const s=t.src.split("/");if(t.src.indexOf("://localhost")!==-1||t.src.indexOf("://127.0.0.1")!==-1||(e="/dist"),s.indexOf(t.type)!==-1)for(const[a,r]of s.entries()){let d=a==0?"":"/";if(n+=`${d}${r}`,r==t.type)return`${n}${e}${t.name}`}else for(const[a,r]of s.entries()){let d=a==0?"":"/";if(n+=`${d}${r}`,r=="src")return`${n}${e}${t.name}`}return`${n}${e}${t.name}`}}};const p=y(),k=y(),E=p.on,O=p.emit,B=k.emit,R=k.on,I=async t=>{const n=await g();return await c.lib.set({lib:t.lib,run_from:"renderer",lazy_lib:t.lazy_lib}),{set:async e=>{console.log("--renderer [set]"),e.return=e?.return||{},e.return.r=e?.return?.r||"full";const s=new $;s.start();let a=e.data?.value?.l||e.data.l,r={r:null,style:"",head:"",benchmark:null};return e.return.r=="full"?r.r="":r.r=[],await(async()=>{for(const i of a){const m=await await c.lib.get({name:i.type,run_from:"renderer",lazy_lib:t.lazy_lib}),l=await(await m.lib.index({f:{name:f=>n.f.name({id:i.id,name:f}),get_lib:async f=>await await c.lib.get({name:f.name,run_from:f.run_from,lazy_lib:t.lazy_lib}),set_theme:async f=>await(await x()).set(f),path:f=>c.path.set({src:m.src,type:i.type,name:f}),uuid:()=>h().set(),wait_until:w}})).set({data:{curr:i}});e?.return?.r=="full"?r.r+=l?.r||"":r.r.push(l?.r||""),r.style+=l?.style||"",r.head+=l?.head||""}})(),s.stop(),r.benchmark=s.result(),r}}},P=async t=>{const n=await g();return await c.lib.set({lib:t.lib,run_from:"hydrator",lazy_lib:t.lazy_lib}),{set:async e=>{console.log("--hydrator [set]");const s=new $;s.start();let a={r:"",style:""},r={style_id:`${h().set()}_stl`},d=e.data?.value?.l||e.data.l;const i=async()=>{for(const m of d){const u=await await c.lib.get({name:m.type,run_from:"hydrator",lazy_lib:t.lazy_lib}),l=u.lib,f=y(),z=f.on,b=await(await l.index({my:{},f:{name:o=>n.f.name({id:m.id,name:o}),get_lib:async o=>await await c.lib.get({name:o.name,run_from:o.run_from,lazy_lib:t.lazy_lib}),set_theme:async o=>await(await x()).set(o),path:o=>c.path.set({src:u.src,type:m.type,name:o}),uuid:()=>h().set(),wait_until:w,call:B,listen:z,new_emitter:()=>y()}})).set({data:{curr:m}});E("msg",async o=>{try{if(Object.keys(o.where||{}).length==0){await f.emit("msg",o);return}}catch{}try{if(m?.[o.where?.key||""]==o.where?.value){await f.emit("msg",o);return}}catch{}}),a.style+=b.style}};await w(()=>document.readyState==="complete"||typeof window<"u",50),await i();try{(m=>{const u=document.getElementById(`${r.style_id}`);u&&u.remove();const l=document.createElement("style");l.id=`${r.style_id}`,l.innerHTML=`${a.style}`,m.appendChild(l)})(document.head)}catch(m){console.log(`${m}, Failed to set style..`)}return s.stop(),{benchmark:s.result()}}}};_.ce_call=O,_.ce_hydrator=P,_.ce_listen=R,_.ce_renderer=I,Object.defineProperty(_,Symbol.toStringTag,{value:"Module"})}));
