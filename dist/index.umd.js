(function(d,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(d=typeof globalThis<"u"?globalThis:d||self,u(d.content_engine_lib={}))})(this,(function(d){"use strict";const u=()=>({set:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const r=Math.random()*16|0;return(e=="x"?r:r&3|8).toString(16)})}),f=async()=>({f:{name:e=>`${e.name}${e.id}`}}),h=async()=>({set:async e=>{console.log("--theme");try{if(!e.el_id)throw new Error("[el_id] is required");const r=e.name,a=document.getElementById(e.el_id);if(!a)throw new Error("[el_id] is invalid");(c=>{const n=s=>{(o=>{const l=o.getAttribute("data-ce");if(!l)return;const _=JSON.parse(l).filter(t=>t?.k.startsWith("t-"));if(_.length!=0)for(const t of _){const b=t.k,g=t.v.split(" ");if(b==`t-${r}-class`)for(const w of g)o.classList.add(w);else for(const w of g)o.classList.remove(w)}})(s)};for(const s of c.getElementsByTagName("*"))n(s);n(c)})(a)}catch(r){const a=`err: [theme] ${r}`;throw console.log(a),a}}});function p(e,r=1e3){let a={cnt:0};return new Promise(c=>{const n=()=>{console.log(`[setInterval] is running.. [count=${a.cnt}]`);try{e()&&(clearInterval(s),c())}catch{console.log(`warn: [wait_until] ignoring the exception in setInterval and will check again after [interval=${r}]`)}a.cnt+=1},s=setInterval(()=>{n()},r);n()})}console.log("content_engine_lib");let i={lib:{inbuilt_lib:[],l:{},set:async e=>{const r=e?.lib||[];for(const[a,c]of r.entries()){const n=c,s=`${n.name}:${e.run_from}`,o=`${e.run_from}_src`;let l=n[o];const y=`${e.run_from}_src`;let _=e?.lazy_lib?.[y]||null;if(_&&(_=_.replace("{*}",`${n.name}`)),console.log(`_lazy_src: ${_}`),console.log(`_src: ${l}`),i.lib.l.hasOwnProperty(`${s}`)==!1){if(/^[a-zA-Z0-9]/.test(l)&&l.includes("/")==!1&&i.lib.inbuilt_lib.indexOf(`${n.name}`)===-1)if(_)l=_;else throw`[lib-name=${n.name},lib-src=${l}] not allowed or available in in-build mode. Need to use lazy-lib config.`;if(l.startsWith("./")||l.startsWith("../")){const t=await import(`${l}`);i.lib.l[`${s}`]={lib:t,src:l}}if(l.startsWith("http://")||l.startsWith("https://")){const t=await import(`${l}`);i.lib.l[`${s}`]={lib:t,src:l}}}}console.log(await i.lib.get_all({}))},get:async e=>{let r=null;const a=`${e.name}:${e.run_from}`;return i.lib.l.hasOwnProperty(`${a}`)==!1&&await i.lib.set({lib:[{renderer_src:e.name,hydrator_src:e.name,editor_src:e.name,name:e.name}],run_from:e.run_from,lazy_lib:e.lazy_lib}),r=i.lib.l[`${a}`],r},get_all:async e=>i.lib.l},path:{set:e=>{let r="";const a=e.src.split("/");if(a.indexOf(e.type)!==-1)for(const[c,n]of a.entries()){let s=c==0?"":"/";if(r+=`${s}${n}`,n==e.type)return`${r}${e.name}`}else for(const[c,n]of a.entries()){let s=c==0?"":"/";if(r+=`${s}${n}`,n=="src")return`${r}${e.name}`}return`${r}${e.name}`}}};const x=async e=>{const r=await f();return await i.lib.set({lib:e.lib,run_from:"renderer",lazy_lib:e.lazy_lib}),{set:async(a,c)=>{console.log("--renderer [set]");let n={r:"",style:""};return await(async()=>{for(const o of a.data?.value?.l||a.data.l){const l=await await i.lib.get({name:o.type,run_from:"renderer",lazy_lib:e.lazy_lib}),_=await(await l.lib.index({f:{name:t=>r.f.name({id:o.id,name:t}),get_lib:async t=>await await i.lib.get({name:t.name,run_from:t.run_from,lazy_lib:e.lazy_lib}),set_theme:async t=>await(await h()).set(t),path:t=>i.path.set({src:l.src,type:o.type,name:t})}})).set({data:{curr:o}},c);n.r+=_.r,n.style+=_.style}})(),n}}},$=async e=>{const r=await f();return await i.lib.set({lib:e.lib,run_from:"hydrator",lazy_lib:e.lazy_lib}),{set:async(a,c)=>{console.log("--hydrator [set]");let n={r:"",style:""};const s=async()=>{for(const o of a.data?.value?.l||a.data.l){const l=await await i.lib.get({name:o.type,run_from:"hydrator",lazy_lib:e.lazy_lib}),_=await(await l.lib.index({f:{name:t=>r.f.name({id:o.id,name:t}),get_lib:async t=>await await i.lib.get({name:t.name,run_from:t.run_from,lazy_lib:e.lazy_lib}),set_theme:async t=>await(await h()).set(t),path:t=>i.path.set({src:l.src,type:o.type,name:t})}})).set({data:{curr:o}},c);n.style+=_.style}};return await p(()=>document.readyState==="complete"||typeof window<"u",50),await s(),n}}},z=async e=>(await f(),await i.lib.set({lib:e.lib,run_from:"editor",lazy_lib:e.lazy_lib}),{set:async(r,a)=>{console.log("--editor [set]");let c={data:{l:[{id:u().set(),type:"editor",data:{l:[]}}]}},n={r:"",style:""};const s=x,o=$,l=await s({lib:e.lib,lazy_lib:e.lazy_lib}),y=await o({lib:e.lib,lazy_lib:e.lazy_lib}),_=await l.set({data:c.data});return(async()=>{const t=await y.set({data:c.data},{change:b=>{a?.change(b)}});(b=>{const m=document.createElement("style");m.innerHTML=`${t.style}`,b.appendChild(m)})(document.head)})(),n.r=_.r,n.style=`
            ${_.style}
            `,n}});d.ce_editor=z,d.ce_hydrator=$,d.ce_renderer=x,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})}));
