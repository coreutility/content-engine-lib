(function(d,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(d=typeof globalThis<"u"?globalThis:d||self,u(d["content-engine-lib"]={}))})(this,(function(d){"use strict";const u=()=>({set:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=Math.random()*16|0;return(e=="x"?a:a&3|8).toString(16)})}),b=async()=>({f:{name:e=>`${e.name}${e.id}`}}),w=async()=>({set:async e=>{console.log("--theme");try{if(!e.el_id)throw new Error("[el_id] is required");const a=e.name,r=document.getElementById(e.el_id);if(!r)throw new Error("[el_id] is invalid");(_=>{const n=s=>{(i=>{const l=i.getAttribute("data-ce");if(!l)return;const c=JSON.parse(l).filter(t=>t?.k.startsWith("t-"));if(c.length!=0)for(const t of c){const f=t.k,g=t.v.split(" ");if(f==`t-${a}-class`)for(const h of g)i.classList.add(h);else for(const h of g)i.classList.remove(h)}})(s)};for(const s of _.getElementsByTagName("*"))n(s);n(_)})(r)}catch(a){const r=`err: [theme] ${a}`;throw console.log(r),r}}});function p(e,a=1e3){let r={cnt:0};return new Promise(_=>{const n=()=>{console.log(`[setInterval] is running.. [count=${r.cnt}]`);try{e()&&(clearInterval(s),_())}catch{console.log(`warn: [wait_until] ignoring the exception in setInterval and will check again after [interval=${a}]`)}r.cnt+=1},s=setInterval(()=>{n()},a);n()})}console.log("content_engine_lib");let o={lib:{inbuilt_lib:[],l:{},set:async e=>{const a=e?.lib||[];for(const[r,_]of a.entries()){const n=_,s=`${n.name}:${e.run_from}`,i=`${e.run_from}_src`;let l=n[i];const y=`${e.run_from}_src`;let c=e?.lazy_lib?.[y]||null;if(c&&(c=c.replace("{*}",`${n.name}`)),console.log(`_lazy_src: ${c}`),console.log(`_src: ${l}`),o.lib.l.hasOwnProperty(`${s}`)==!1){if(/^[a-zA-Z0-9]/.test(l)&&l.includes("/")==!1&&o.lib.inbuilt_lib.indexOf(`${n.name}`)===-1)if(c)l=c;else throw`[lib-name=${n.name},lib-src=${l}] not allowed or available in in-build mode. Need to use lazy-lib config.`;if(l.startsWith("./")||l.startsWith("../")){const t=await import(`${l}`);o.lib.l[`${s}`]={lib:t,src:l}}if(l.startsWith("http://")||l.startsWith("https://")){const t=await import(`${l}`);o.lib.l[`${s}`]={lib:t,src:l}}}}console.log(await o.lib.get_all({}))},get:async e=>{let a=null;const r=`${e.name}:${e.run_from}`;return o.lib.l.hasOwnProperty(`${r}`)==!1&&await o.lib.set({lib:[{renderer_src:e.name,hydrator_src:e.name,editor_src:e.name,name:e.name}],run_from:e.run_from,lazy_lib:e.lazy_lib}),a=o.lib.l[`${r}`],a},get_all:async e=>o.lib.l},path:{set:e=>{let a="",r="";const _=e.src.split("/");if(e.src.indexOf("://localhost")!==-1||e.src.indexOf("://127.0.0.1")!==-1||(r="/dist"),_.indexOf(e.type)!==-1)for(const[n,s]of _.entries()){let i=n==0?"":"/";if(a+=`${i}${s}`,s==e.type)return`${a}${r}${e.name}`}else for(const[n,s]of _.entries()){let i=n==0?"":"/";if(a+=`${i}${s}`,s=="src")return`${a}${r}${e.name}`}return`${a}${r}${e.name}`}}};const $=async e=>{const a=await b();return await o.lib.set({lib:e.lib,run_from:"renderer",lazy_lib:e.lazy_lib}),{set:async(r,_)=>{console.log("--renderer [set]");let n={r:"",style:"",head:""};return await(async()=>{for(const i of r.data?.value?.l||r.data.l){const l=await await o.lib.get({name:i.type,run_from:"renderer",lazy_lib:e.lazy_lib}),c=await(await l.lib.index({f:{name:t=>a.f.name({id:i.id,name:t}),get_lib:async t=>await await o.lib.get({name:t.name,run_from:t.run_from,lazy_lib:e.lazy_lib}),set_theme:async t=>await(await w()).set(t),path:t=>o.path.set({src:l.src,type:i.type,name:t})}})).set({data:{curr:i}},_);n.r+=c?.r||"",n.style+=c?.style||"",n.head+=c?.head||""}})(),n}}},x=async e=>{const a=await b();return await o.lib.set({lib:e.lib,run_from:"hydrator",lazy_lib:e.lazy_lib}),{set:async(r,_)=>{console.log("--hydrator [set]");let n={r:"",style:""};const s=async()=>{for(const i of r.data?.value?.l||r.data.l){const l=await await o.lib.get({name:i.type,run_from:"hydrator",lazy_lib:e.lazy_lib}),c=await(await l.lib.index({f:{name:t=>a.f.name({id:i.id,name:t}),get_lib:async t=>await await o.lib.get({name:t.name,run_from:t.run_from,lazy_lib:e.lazy_lib}),set_theme:async t=>await(await w()).set(t),path:t=>o.path.set({src:l.src,type:i.type,name:t})}})).set({data:{curr:i}},_);n.style+=c.style}};return await p(()=>document.readyState==="complete"||typeof window<"u",50),await s(),n}}},z=async e=>(await b(),await o.lib.set({lib:e.lib,run_from:"editor",lazy_lib:e.lazy_lib}),{set:async(a,r)=>{console.log("--editor [set]");let _={data:{l:[{id:u().set(),type:"editor",data:{l:[]}}]}},n={r:"",style:""};const s=$,i=x,l=await s({lib:e.lib,lazy_lib:e.lazy_lib}),y=await i({lib:e.lib,lazy_lib:e.lazy_lib}),c=await l.set({data:_.data});return(async()=>{const t=await y.set({data:_.data},{change:f=>{r?.change(f)}});(f=>{const m=document.createElement("style");m.innerHTML=`${t.style}`,f.appendChild(m)})(document.head)})(),n.r=c.r,n.style=`
            ${c.style}
            `,n}});d.ce_editor=z,d.ce_hydrator=x,d.ce_renderer=$,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})}));
